# API Системы Рекомендаций Друзей

## Обзор

Система рекомендаций друзей предоставляет интеллектуальные предложения пользователей для добавления в друзья на основе различных факторов совместимости.

## Endpoint

```
GET /api/friends/recommendations/
```

## Авторизация

Требуется токен авторизации в заголовке:
```
Authorization: Token <your_token>
```

## Параметры запроса

| Параметр | Тип | Обязательный | По умолчанию | Описание |
|----------|-----|--------------|--------------|----------|
| `limit` | integer | Нет | 10 | Максимальное количество рекомендаций |

## Пример запроса

```bash
curl -H "Authorization: Token your_token_here" \
     "http://localhost:8000/api/friends/recommendations/?limit=5"
```

## Структура ответа

```json
{
  "recommendations": [
    {
      "id": 123,
      "username": "john_doe",
      "first_name": "John",
      "last_name": "Doe",
      "avatar_url": "http://localhost:8000/media/avatars/john.jpg",
      "level": 15,
      "recommendation_score": 8.75,
      "recommendation_reasons": [
        "Общие интересы: Python, JS, Coffee",
        "2 общих друга",
        "Активный пользователь (уровень 15)"
      ],
      "mutual_friends_count": 2,
      "common_interests": ["python", "js", "coffee"]
    }
  ],
  "total_count": 1,
  "algorithm_version": "1.0"
}
```

## Поля ответа

### Основные поля пользователя
- `id` - ID пользователя
- `username` - Имя пользователя
- `first_name` - Имя
- `last_name` - Фамилия
- `avatar_url` - URL аватарки
- `level` - Уровень активности пользователя

### Поля рекомендации
- `recommendation_score` - Общий скор рекомендации (0-100+)
- `recommendation_reasons` - Список причин рекомендации
- `mutual_friends_count` - Количество общих друзей
- `common_interests` - Список общих интересов

### Метаданные
- `total_count` - Общее количество рекомендаций
- `algorithm_version` - Версия алгоритма рекомендаций

## Алгоритм рекомендаций

Система использует многофакторный алгоритм для расчета релевантности:

### 1. Общие интересы (2 балла за интерес)
Анализирует поле `interests` в профиле пользователя:
```json
{
  "interests": {
    "hobby": ["Python", "JS", "Coffee", "Apple", "Mac"]
  }
}
```

### 2. Взаимные друзья (3 балла за друга)
Ищет пользователей, которые являются друзьями ваших друзей ("друзья друзей").

### 3. Активность пользователя (до 5 баллов)
Бонус за высокий уровень активности пользователя.

### 4. Случайный фактор (до 1 балла)
Добавляет разнообразие в рекомендации.

### 5. Базовый скор для новых пользователей (0.1 балла)
Минимальный скор для активных пользователей без явных связей.

## Фильтрация

Система автоматически исключает:
- Текущего пользователя
- Уже существующих друзей
- Пользователей с активными заявками в друзья
- Неактивных пользователей

## Сортировка

Рекомендации сортируются по:
1. Скору рекомендации (по убыванию)
2. Случайному фактору (для равных скоров)

## Коды ошибок

| Код | Описание |
|-----|----------|
| 200 | Успешный запрос |
| 401 | Требуется авторизация |
| 500 | Внутренняя ошибка сервера |

## Расширяемость

Архитектура системы позволяет легко добавлять новые критерии рекомендаций:

1. **Геолокация** - рекомендации по местоположению
2. **Курсы** - пользователи с общими курсами
3. **Активность** - схожие паттерны использования
4. **Возраст/демография** - демографические факторы
5. **Машинное обучение** - ML-модели для предсказания совместимости

## Примеры использования

### Получить топ-5 рекомендаций
```javascript
fetch('/api/friends/recommendations/?limit=5', {
  headers: {
    'Authorization': 'Token ' + userToken
  }
})
.then(response => response.json())
.then(data => {
  console.log('Рекомендации:', data.recommendations);
});
```

### Обработка рекомендаций в React
```jsx
const [recommendations, setRecommendations] = useState([]);

useEffect(() => {
  fetchRecommendations()
    .then(data => setRecommendations(data.recommendations));
}, []);

return (
  <div>
    {recommendations.map(user => (
      <UserCard 
        key={user.id}
        user={user}
        score={user.recommendation_score}
        reasons={user.recommendation_reasons}
      />
    ))}
  </div>
);
```

## Производительность

- Рекомендуется кэшировать результаты на клиенте
- Используйте пагинацию для больших списков
- Обновляйте рекомендации периодически, а не при каждом запросе

## Мониторинг

Для отслеживания эффективности системы рекомендуется логировать:
- Количество показанных рекомендаций
- Количество принятых заявок из рекомендаций
- Средний скор принятых рекомендаций